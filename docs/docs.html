<!DOCTYPE HTML>
<html>
	<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Docs |Â aiohttp_auth</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="" />
	<meta name="keywords" content="" />
	<meta name="author" content="" />

  <!-- Facebook and Twitter integration -->
	<meta property="og:title" content=""/>
	<meta property="og:image" content=""/>
	<meta property="og:url" content=""/>
	<meta property="og:site_name" content=""/>
	<meta property="og:description" content=""/>
	<meta name="twitter:title" content="" />
	<meta name="twitter:image" content="" />
	<meta name="twitter:url" content="" />
	<meta name="twitter:card" content="" />

	<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
	<link rel="shortcut icon" href="favicon.ico">

	<link href="https://fonts.googleapis.com/css?family=Karla:400,700" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,400i,700" rel="stylesheet">
	
	<!-- Animate.css -->
	<link rel="stylesheet" href="css/animate.css">
	<!-- Icomoon Icon Fonts-->
	<link rel="stylesheet" href="css/icomoon.css">
	<!-- Bootstrap  -->
	<link rel="stylesheet" href="css/bootstrap.css">
	<!-- Owl Carousel -->
	<link rel="stylesheet" href="css/owl.carousel.min.css">
	<link rel="stylesheet" href="css/owl.theme.default.min.css">
	<!-- Magnific Popup -->
	<link rel="stylesheet" href="css/magnific-popup.css">

	<link rel="stylesheet" href="css/style.css">


	<!-- Modernizr JS -->
	<script src="js/modernizr-2.6.2.min.js"></script>
	<!-- FOR IE9 below -->
	<!--[if lt IE 9]>
	<script src="js/respond.min.js"></script>
	<![endif]-->

	<link rel="stylesheet" href="css/prism.css">
	</head>
	<body>

	<nav id="colorlib-main-nav" role="navigation">
		<a href="#" class="js-colorlib-nav-toggle colorlib-nav-toggle active"><i></i></a>
		<div class="colorlib-table">
			<div class="colorlib-table-cell">

				<div class="row">
					<div class="col-md-12">
						<ul>
							<li class="active"><a href="index.html">Home</a></li>
							<li><a href="work.html">Documentation</a></li>
						</ul>
					</div>
				</div>
				<div class="row">
						<div id="login_required" class="white-popup mfp-hide popup_code">
					
							<pre>

								<code class="language-python">
								from aiohttp import web
								from aiohttp_auth import auth


								async def authenticate(request):
									user = {
										"user_id": "5",
										"name": "K Lars Lohn",
									}
									return user


								async def public(request):
									return web.json_response({'hello': 'anonymous'})


								@auth.login_required
								async def protected(request):
									return web.json_response({'hello': 'user'})


								def create_app():
									app = web.Application()

									app.router.add_get('/public', public)
									app.router.add_get('/protected', protected)

									auth.setup(app, authenticate, jwt_secret="test")
									return app


								if __name__ == '__main__':
									app = create_app()
									web.run_app(app)

							</code>
						</pre>
					</div>
					<div id="scopes" class="white-popup mfp-hide popup_code">

							<pre>

								<code class="language-python">
								from aiohttp import web
								from aiohttp_auth import auth

								DATABASE = {
								    'david': {'id': 5, 'scopes': ('regular_user',)}
								}

								async def authenticate(request):
								    payload = await request.json()
								    user = DATABASE.get(payload['username'])
								    return user


								async def public(request):
								    return web.json_response({'hello': 'anonymous'})


								@auth.scopes('regular_user')
								async def protected(request):
								    return web.json_response({'hello': 'user'})


								def create_app():
								    app = web.Application()

								    app.router.add_get('/public', public)
								    app.router.add_get('/protected', protected)

								    auth.setup(app, authenticate, jwt_secret="test")
								    return app


								if __name__ == '__main__':
								    app = create_app()
								    web.run_app(app)
							</code>
						</pre>
					</div>
					<div class="col-md-12">
						<h2 class="head-title">Examples
							<br/>
							<small> To Get Started Fast</small>
						</h2>
						
						<a href="#login_required" class="gallery image-popup-link text-center">
							<h4>Login Required</h4>
							<span><i class="icon-search3"></i></span>
						</a>
						<a href="#scopes" class="gallery image-popup-link text-center" >
							<h4>Scopes</h4>
							<span><i class="icon-search3"></i></span>
						</a>
						<a href="#" class="gallery image-popup-link text-center" >
							<h4>Postgres</h4>
							<span><i class="icon-search3"></i></span>
						</a>
						<a href="#" class="gallery image-popup-link text-center">
							<h4>Cassandra</h4>
							<span><i class="icon-search3"></i></span>
						</a>
						<a href="#" class="gallery image-popup-link text-center">
							<h4>MongoDB</h4>
							<span><i class="icon-search3"></i></span>
						</a>
						<a href="#" class="gallery image-popup-link text-center">
							<h4>SqlAlchemy</h4>
							<span><i class="icon-search3"></i></span>
						</a>
					</div>
				</div>
			</div>
		</div>
	</nav>
	
	<div id="colorlib-page">
		<header>
			<div class="container">
				<div class="row">
					<div class="col-md-12">
						<div class="colorlib-navbar-brand">
							<a class="colorlib-logo" href="index.html">aiohttp_auth</a>
						</div>
						<a href="#" class="js-colorlib-nav-toggle colorlib-nav-toggle"><i></i></a>
					</div>
				</div>
			</div>
		</header>
		
		<div id="colorlib-work">
			<div class="container">
				<div class="row text-center">
				
					<h2 class="bold" style="padding-top: 0.5em;">Docs</h2>
				</div>
				<div class="row" style="margin-top: 30em;">
						<div class="col-md-12">
							<div class="work-entry-flex animate-box">
								<div class="col-md-12">
									<div class="row no-gutters">
										<div class="col-md-12 no-gutters">
											<div class="display-t">
												<div class="display-tc">
													<div class="text-inner text-inner-left">
														<h2>About</h2>
														<p><b> aiohttp_auth </b> is a JWT authentication library for aiohttp.</p>
														<p> It allows to protect endpoints and also provides authentication scoping.
														</p>
														<p>
														The main motivation for the development of this project 
														was to create an easy-to-use, standards-compliant authentication library 
														with comprehensive documentation and code samples.
														</p>

														<h2>Basic Usage</h2>
														<p> To get started, we need to define an authenticate method to return the jwt payload. </p>
														<pre>
														<code class="language-python">
														async def authenticate(request):
															payload = await request.json()
															user = DATABASE.get(payload['username'])
															return user
														</code>
														</pre>
														<p> You can use any possible way to fetch the user in here but, 
														returning instance should be a <b>dict</b> or 
														a class instance that can be converted to dict by using <b> dict(instance) </b>.
														To demonstrate with code samples:
														</p>
														
																<h3> Using dict </h3>
																<pre>
																	<code class="language-python">
																	async def authenticate(request):
																		user = {"user_id": "5", "name": "K Lars Lohn"}
																		return user

																	</code>
																</pre>
															
																<h3> Using dataclasses </h3>
																<pre>
																	<code class="language-python">
																	@dataclass
																	class User:
																		id: int
																		name: str

																	async def authenticate(request):
																		user = User(id=5, name="K Lars Lohn")
																		return user
																	</code>
																</pre>
																
														
														<h3> Initialization </h3>
														<p> Now we can add authentication to our application using the <b> auth.setup() </b> method. </p>
														<pre>
															<code class="language-python">
																auth.setup(app, authenticate, jwt_secret="your_secret_key")
															</code>
														</pre>
														
														<h3> Protecting the routes </h3>
														<p> We need just 1 more step to get a fully functional authentication system. We need to add 
														the <b> @auth.login_required </b> decorator on top of the routes we want to protect.
														</p>

														<pre>
															<code class="language-python">
																async def public(request):
																	return web.json_response({'hello': 'public'})

																@auth.login_required
																async def protected(request):
																	return web.json_response({'hello': 'protected'})
															</code>
														</pre>
														<p> And thats it! You have protected one of your end-points. aiohttp_auth also automatically creates some routes such as,
														<b> auth/ </b> to log into the system and <b> me/ </b> to get the current user information.
														</p>
														<p>Whole code</p>
														<pre>
															<code class="language-python">
																	from aiohttp import web
																	from aiohttp_auth import auth
																	
																	async def authenticate(request):
																		user = { "id": "5", "name": "K Lars Lohn"}
																		return user
																	
																	async def public(request):
																		return web.json_response({'hello': 'public'})
																
																	@auth.login_required
																	async def protected(request):
																		return web.json_response({'hello': request.user['name']})
																	
																	app = web.Application()
																	app.router.add_get('/protected', protected)
																	auth.setup(app, authenticate, jwt_secret="test")
																	web.run_app(app)
															</code>
														</pre>
														<p>
														How convenient!
														</p>
														<h3> Scoping </h3>
														<pre>
															<code class="language-python">
																@auth.scopes('regular_user')
																async def protected(request):
																	return web.json_response({'hello': 'protected'})
															</code>
														</pre>
														<p>
															This is also equivalent to <b>scopes('regular_user',  algorithm='any')</b>
															which opens the end-point for any user who has <b>'regular_user'</b> in his scopes. 
														</p>
														<p> We can use other pre-defined algorithms.
														<code>algorithm='all'</code> opens the end-point to users who has all of the required scopes.
														End-point is also open for users with more scopes than its required with <b>all</b> algorithm.
														If you want to open the end-point for the users who have the same scopes with the end-point
														you can use the <code>algorithm='exact'</code> .
														</p>
														<pre>
																<code class="language-python">
																	# match all users who has a superset of required scopes
																	@auth.scopes('regular_user', algorithm='all')
																	async def protected(request):
																		return web.json_response({'hello': 'protected'})
																	
																	# match all users who has the exact scopes
																	@auth.scopes('regular_user', algorithm='exact')
																	async def protected(request):
																		return web.json_response({'hello': 'protected'})
															
																</code>
															</pre>
															<p> You can also define your own matching algorithm.</p>
															<pre>
																	<code class="language-python">
																		user = {
																			'scopes': ('jack',)
																		}
																		
																		def jacks_algorithm(required_scopes: Iterable, user_scopes: Iterable) -> bool:
																			# required_scopes -> ('user', 'admin')
																			# You can match the required and the provided (user's) scopes
																			# however you want
																			has_permission = 'jack' in user_scopes
																			return has_permission
																		
																		@auth.scopes('user', 'admin', algorithm=jacks_algorithm)
																		async def protected(request):
																			return web.json_response({'hello': 'jack'})
																
																	</code>
																</pre>
																<h3>Built-in Error Responses</h3>
																<h4 id="unauthorized">Authentication Required</h4>
																<label> 401, UNAUTHORIZED </label>
																<pre>
																		<code class="language-json">
																				{
																					"type": "https://mgurdal.github.io/aiohttp_auth/docs.html#unauthorized",
																					"title": "Authentication Required",
																					"detail": "You did not specify the required token information in headers or you provided it incorrectly.",
																					"instance": "http://0.0.0.0:8080/protected/",
																					"status": 401
																				}
																		</code>
																	</pre>

																	<h4 id="invalid_token">Invalid Token</h4>
																	<label> 400, BAD REQUEST </label>
																	<pre>
																			<code class="language-json">
																					{
																						"type": "https://mgurdal.github.io/aiohttp_auth/docs.html#invalid_token",
																						"title": "Invalid Token",
																						"detail": "You provided an invalid JWT signature.",
																						"instance": "http://0.0.0.0:8080/protected/",
																						"status": 400
																					}
																			</code>
																		</pre>

																	<label> 401, UNAUTHORIZED </label>
																	<pre>
																			<code class="language-json">
																					{
																						"type": "https://mgurdal.github.io/aiohttp_auth/docs.html#token_expired",
																						"title": "Invalid Token",
																						"detail": "The access token provided has expired.",
																						"instance": "http://0.0.0.0:8080/protected/",
																						"status": 401
																					}
																			</code>
																		</pre>

																	<h4 id="forbidden">You do not have access to this url.</h4>
																	<label> 403, FORBIDDEN </label>
																	<pre>
																			<code class="language-json">
																					{
																						"type": "https://mgurdal.github.io/aiohttp_auth/docs.html#forbidden",
																						"title": "You do not have access to this url.",
																						"detail": "User scope does not meet access requirements for http://0.0.0.0:8080/protected/",
																						"instance": "http://0.0.0.0:8080/protected/",
																						"status": 403
																					}
																			</code>
																	</pre>

																	<h3>User Defined Error Responses</h3>
																	<h4 id="user_defined">User Defined Exceptions</h4>
																	<pre>
																			<code class="language-python">
																					class UserDoesNotExistsError(UserDefinedException):
																						status = 404
																						title = "User does not exists."
																						detail = "We could not find the user with {name}"

																					async def authenticate(request):
																						raise UserDoesNotExistsError(name="K Lars Lohn")

																			</code>

																	</pre>
																	<pre>

																			<code class="language-json">
																					{
																						"type": "https://mgurdal.github.io/aiohttp_auth/docs.html#user_defined",
																						"title": "User does not exists.",
																						"detail": "We could not find the user with K Lars Lohn",
																						"instance": "http://0.0.0.0:8080/protected/",
																						"status": 404
																					}
																			</code>
																	</pre>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
				</div>
			</div>
		</div>

		<footer>
			<div id="footer">
				<div class="container">
					<div class="row">
						<div class="col-md-4 col-pb-sm text-center">
							<div class="row">
								<div class="col-md-10">
								</div>
							</div>
						</div>
						<div class="col-md-4 col-pb-sm text-center">
						</div>
						<div class="col-md-4 col-pb-sm text-center">
						</div>
					</div>
					<div class="row">
						<div class="col-md-12 text-center">
							<p>
								<span class="block"><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="icon-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --><br></span> 
							</p>
						</div>
					</div>
				</div>
			</div>
		</footer>
	
	</div>

	<!-- jQuery -->
	<script src="js/jquery.min.js"></script>
	<!-- jQuery Easing -->
	<script src="js/jquery.easing.1.3.js"></script>
	<!-- Bootstrap -->
	<script src="js/bootstrap.min.js"></script>
	<!-- Waypoints -->
	<script src="js/jquery.waypoints.min.js"></script>
	<!-- Owl Carousel -->
	<script src="js/owl.carousel.min.js"></script>
	<!-- Magnific Popup -->
	<script src="js/jquery.magnific-popup.min.js"></script>
	<script src="js/magnific-popup-options.js"></script>

	<!-- Main JS (Do not remove) -->
	<script src="js/main.js"></script>

	<script src="js/prism.js"></script>
	</body>
</html>

